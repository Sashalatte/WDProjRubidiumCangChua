<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ClickHub â€” Download</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="../assets/Clickhub-logo-1.png">
</head>
<style>
  body { margin: 0; font-family: Arial; text-align: center; }

  .page-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('../assets/background-download.png');
    background-size: cover;
    background-position: center;
    z-index: 1;
  }

  h1 { margin-top: 20px; color: #fff; text-shadow: 1px 1px 3px #000; }

  #photobooth-frame {
    display: inline-block;
    margin-top: 30px;
    background: #fff;
    padding: 10px;
    border: 4px solid #333;
    z-index: 2;
    position: relative;
  }

  .photo {
    margin: 5px 0;
  }

  .layout-2x2 { display: grid; grid-template-columns: 1fr 1fr; grid-auto-rows: 150px; grid-gap: 5px; }
  .layout-4x1 { display: grid; grid-template-columns: 1fr; grid-auto-rows: 150px; grid-gap: 5px; }
  .layout-4x2 { display: grid; grid-template-columns: 1fr 1fr; grid-auto-rows: 150px; grid-gap: 5px; }

  #downloadBtn {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 20px;
    cursor: pointer;
    z-index: 2;
    position: relative;
  }
</style>
<body>

  <header>
    <nav>
      <a href="home.html">Home</a>
      <a href="grid.html">Grid</a>
      <a href="booth.html">Booth</a>
      <a href="edit.html">Edit</a>
      <a href="download.html">Download</a>
      <a href="about.html">About</a>
    </nav>
  </header>

</head>
<body>

<div class="page-background"></div>

<h1>Your Photobooth Strip</h1>

<div id="photobooth-frame"></div>

<button id="downloadBtn">Download Strip</button>

<script>
let photos = JSON.parse(localStorage.getItem("boothPhotos") || "[]");
let layout = localStorage.getItem("selectedGrid") || "2x2";

const frame = document.getElementById("photobooth-frame");
frame.className = ""; 
if (layout === "2x2") frame.classList.add("layout-2x2");
if (layout === "4x1") frame.classList.add("layout-4x1");
if (layout === "4x2") frame.classList.add("layout-4x2");

photos.forEach(src => {
  const img = document.createElement("img");
  img.src = src;
  img.className = "photo";
  img.width = 200;
  img.height = 150;
  frame.appendChild(img);
});

document.getElementById("downloadBtn").addEventListener("click", () => {
  let cols = 1, rows = 1;
  if (layout === "2x2") { cols = 2; rows = 2; }
  if (layout === "4x1") { cols = 1; rows = 4; }
  if (layout === "4x2") { cols = 2; rows = 4; }

  const photoWidth = 200;
  const photoHeight = 150;
  const gap = 5;
  const width = cols * photoWidth + (cols-1)*gap;
  const height = rows * photoHeight + (rows-1)*gap;

  const canvas = document.createElement("canvas");
  canvas.width = width;
  canvas.height = height;
  const ctx = canvas.getContext("2d");

  photos.forEach((src, i) => {
    let col = i % cols;
    let row = Math.floor(i / cols);
    const img = new Image();
    img.src = src;
    img.onload = (() => {
      return function() {
        ctx.drawImage(img, col*(photoWidth+gap), row*(photoHeight+gap), photoWidth, photoHeight);

        if (i === photos.length - 1) {
          const link = document.createElement("a");
          link.download = "photobooth_strip.png";
          link.href = canvas.toDataURL();
          link.click();
        }
      }
    })();
  });
});
</script>

</body>
</html>
