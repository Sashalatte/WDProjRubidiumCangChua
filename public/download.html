<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClickHub â€” Download</title>

<style>
body {
  margin: 0;
  font-family: Arial;
}

.page-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('../assets/background-download.png');
  background-size: cover;
  background-position: center;
  z-index: 0;
}

header {
  position: relative;
  z-index: 10;
  width: 100%;
}

header nav a {
  color: white;
  text-decoration: none;
  font-weight: bold;
  margin-right: 20px;
}

.main-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  margin-top: 180px;
  gap: 60px;
  position: relative;
  z-index: 5;
}

#photobooth-frame {
  display: grid;
  gap: 8px;
  padding: 12px;
  background: black;
  border: 3px solid #111;
}

.photo {
  width: 100px;
  height: 80px;
  object-fit: cover;
  display: block;
}

#downloadBtn {
  padding: 12px 24px;
  font-size: 16px;
  cursor: pointer;
  background: transparent;
  border: 2px solid black;
  color: black;
}
</style>
</head>

<body>

<div class="page-background"></div>

<header>
<nav>
<a href="home.html">Home</a>
<a href="grid.html">Grid</a>
<a href="booth.html">Booth</a>
<a href="edit.html">Edit</a>
<a href="download.html">Download</a>
<a href="about.html">About</a>
</nav>
</header>

<div class="main-container">
<div id="photobooth-frame"></div>
<button id="downloadBtn">Download Strip</button>
</div>

<script>
const photos = JSON.parse(localStorage.getItem("capturedPhotos") || "[]")
const stripColor = localStorage.getItem("stripColor") || "black"

const frame = document.getElementById("photobooth-frame")

frame.style.background = stripColor

function darkenColor(hex, amount = 60) {
  if(hex === "black") return "#111111"
  let col = hex.replace("#","")
  let num = parseInt(col,16)
  let r = (num >> 16) - amount
  let g = ((num >> 8) & 0x00FF) - amount
  let b = (num & 0x0000FF) - amount
  r = r < 0 ? 0 : r
  g = g < 0 ? 0 : g
  b = b < 0 ? 0 : b
  return "#" + (r<<16 | g<<8 | b).toString(16).padStart(6,"0")
}

frame.style.borderColor = darkenColor(stripColor)

photos.forEach(src => {
  const img = document.createElement("img")
  img.src = src
  img.className = "photo"
  frame.appendChild(img)
})

document.getElementById("downloadBtn").addEventListener("click", () => {
  if (photos.length === 0) return

  const width = 124
  const height = photos.length * 80 + (photos.length - 1) * 8 + 24

  const canvas = document.createElement("canvas")
  canvas.width = width
  canvas.height = height
  const ctx = canvas.getContext("2d")

  ctx.fillStyle = stripColor
  ctx.fillRect(0, 0, width, height)

  let loaded = 0

  photos.forEach((src, i) => {
    const img = new Image()
    img.src = src
    img.onload = () => {
      ctx.drawImage(img, 12, i * (80 + 8) + 12, 100, 80)
      loaded++

      if (loaded === photos.length) {
        const link = document.createElement("a")
        link.download = "photobooth_strip.png"
        link.href = canvas.toDataURL("image/png")
        link.click()
      }
    }
  })
})
</script>

</body>
</html>
