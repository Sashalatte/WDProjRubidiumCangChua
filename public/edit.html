<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ClickHub — Edit</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" href="../assets/Clickhub-logo-1.png">
<style>
body { margin: 0; font-family: Arial; }

.page-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('../assets/background-edit.png');
  background-size: cover;
  background-position: center;
  z-index: 1;
}

header {
  position: relative;
  z-index: 10;
  width: 100%;
}

.overlay {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
}

#strip {
  position: absolute;
  top: 130px;
  left: 30%;
  transform: translateX(-50%);
  display: grid;
  gap: 8px;
  background: rgb(0, 0, 0);
  padding: 12px;
  border: 2px solid rgb(0, 0, 0);
}

.photo-frame {
  width: 90px;
  height: 90px;
  background: white;
  border: 2px solid rgb(0, 0, 0);
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.photo-frame img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.controls {
  position: absolute;
  top: 200px;
  left: 85%;
  transform: translateX(-60%);
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.cycle-btn {
  font-size: 16px;
  padding: 10px 18px;
  cursor: pointer;
}

.next {
  position: fixed;
  bottom: 25px;
  right: 25px;
  z-index: 100;
  padding: 12px 25px;
  font-size: 1.2rem;
  background: rgba(255, 255, 255, 0.35);
  border: 2px solid black;
  border-radius: 10px;
  cursor: pointer;
  backdrop-filter: blur(4px);
}
</style>

</head>

<body>
<div class="page-background"></div>

<header>
<nav>
<a href="home.html">Home</a>
<a href="grid.html">Grid</a>
<a href="booth.html">Booth</a>
<a href="edit.html">Edit</a>
<a href="download.html">Download</a>
<a href="about.html">About</a>
</nav>
</header>

<div class="overlay">
<div id="strip"></div>

<div class="controls">
<button id="brightnessBtn" class="cycle-btn">Brightness: Normal</button>
<button id="colorBtn" class="cycle-btn">Color: Normal</button>
<button id="frameBtn" class="cycle-btn">Frame Color: Default</button>
</div>
</div>

<button class="next" onclick="window.location.href='download.html'">Next →</button>

<script>
const strip = document.getElementById("strip")
let photos = JSON.parse(localStorage.getItem("capturedPhotos") || "[]")

if (photos.length === 0) {
  photos = [
    "../assets/sample1.png",
    "../assets/sample2.png",
    "../assets/sample3.png",
    "../assets/sample4.png"
  ]
}

const selectedGrid = localStorage.getItem("selectedGrid") || "2x2"

function getGridDimensions(grid) {
  switch(grid) {
    case "2x2": return {rows:2, cols:2}
    case "4x1": return {rows:4, cols:1}
    case "4x2": return {rows:4, cols:2}
    default: return {rows:2, cols:2}
  }
}

const {rows, cols} = getGridDimensions(selectedGrid)

strip.style.display = "grid"
strip.style.gridTemplateRows = `repeat(${rows}, 1fr)`
strip.style.gridTemplateColumns = `repeat(${cols}, 1fr)`
strip.innerHTML = ""

photos.slice(0, rows * cols).forEach(src => {
  const frame = document.createElement("div")
  frame.className = "photo-frame"
  const img = document.createElement("img")
  img.src = src
  frame.appendChild(img)
  strip.appendChild(frame)
})

const brightnessOptions = [
  {name:"Darker", value:0.7},
  {name:"Lighter", value:1.3},
  {name:"Normal", value:1}
]

const colorOptions = [
  {name:"Cool Tone", css:"contrast(115%) saturate(140%) hue-rotate(190deg)"},
  {name:"Sepia", css:"sepia(100%)"},
  {name:"Vintage", css:"contrast(90%) saturate(80%) sepia(40%)"},
  {name:"Normal", css:""}
]

const frameColors = [
  {name:"Pink", inside:"#FFE2FD"},
  {name:"Mint", inside:"#CEFFC9"},
  {name:"Dark Blue", inside:"#161846"},
  {name:"Yellow", inside:"#FFFEBC"},
  {name:"Black", inside:"#000000"},
  {name:"White", inside:"#FFFFFF"}
]

let bIndex = parseInt(localStorage.getItem("brightnessIndex") || "2")
let cIndex = parseInt(localStorage.getItem("colorIndex") || "3")
let fIndex = -1
const savedStripColor = localStorage.getItem("stripColor") || "rgb(0,0,0)"

const brightnessBtn = document.getElementById("brightnessBtn")
const colorBtn = document.getElementById("colorBtn")
const frameBtn = document.getElementById("frameBtn")

function darkenColor(hex, amount = 60) {
  let col = hex.replace("#","")
  let num = parseInt(col,16)
  let r = (num >> 16) - amount
  let g = ((num >> 8) & 0x00FF) - amount
  let b = (num & 0x0000FF) - amount
  r = r < 0 ? 0 : r
  g = g < 0 ? 0 : g
  b = b < 0 ? 0 : b
  return "#" + (r<<16 | g<<8 | b).toString(16).padStart(6,"0")
}

function applyFilters(){
  const imgs = document.querySelectorAll(".photo-frame img")
  imgs.forEach(img=>{
    const brightness = `brightness(${brightnessOptions[bIndex].value})`
    const color = colorOptions[cIndex].css
    img.style.filter = brightness + " " + color
  })
  brightnessBtn.textContent = "Brightness: " + brightnessOptions[bIndex].name
  colorBtn.textContent = "Color: " + colorOptions[cIndex].name
  localStorage.setItem("brightnessIndex", bIndex)
  localStorage.setItem("colorIndex", cIndex)
}

function applyFrameColor(color){
  const darker = darkenColor(color)
  strip.style.background = color
  strip.style.borderColor = darker
  document.querySelectorAll(".photo-frame").forEach(frame=>{
    frame.style.borderColor = darker
  })
  localStorage.setItem("stripColor", color)
}

applyFrameColor(savedStripColor)

brightnessBtn.onclick = () => {
  bIndex = (bIndex + 1) % brightnessOptions.length
  applyFilters()
}

colorBtn.onclick = () => {
  cIndex = (cIndex + 1) % colorOptions.length
  applyFilters()
}

frameBtn.onclick = () => {
  fIndex = (fIndex + 1) % frameColors.length
  const mainColor = frameColors[fIndex].inside
  applyFrameColor(mainColor)
  frameBtn.textContent = "Frame Color: " + frameColors[fIndex].name
}

applyFilters()
</script>

</body>
</html>
